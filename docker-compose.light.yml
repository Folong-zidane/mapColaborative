# Version ULTRA-LÉGÈRE avec image pré-construite
services:
  postgres:
    image: postgis/postgis:15-3.3
    container_name: osm-postgres
    environment:
      - POSTGRES_DB=gis
      - POSTGRES_USER=osmuser
      - POSTGRES_PASSWORD=osmpassword
    volumes:
      - postgres-data:/var/lib/postgresql/data
    networks:
      - osm-network
    restart: unless-stopped

  tileserver:
    image: overv/openstreetmap-tile-server:latest  # Image pré-construite (500 Mo)
    container_name: osm-tileserver
    depends_on:
      - postgres
    environment:
      - PGHOST=postgres
      - PGDATABASE=gis
      - PGUSER=osmuser
      - PGPASSWORD=osmpassword
    volumes:
      - tile-cache:/data/tiles
      - osm-data:/data/osm
    ports:
      - "80:80"
    networks:
      - osm-network
    restart: unless-stopped

volumes:
  postgres-data:
  tile-cache:
  osm-data:

networks:
  osm-network: